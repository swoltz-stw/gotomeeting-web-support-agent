<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GoToMeeting Support</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=DM+Sans:wght@300;400;500;600&family=DM+Mono:wght@400;500&display=swap');

  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  :root {
    --g2m-blue: #0066FF;
    --g2m-dark: #0A1628;
    --g2m-mid: #132040;
    --g2m-surface: #1A2D50;
    --g2m-border: rgba(0,102,255,0.2);
    --g2m-text: #E8EDF5;
    --g2m-muted: #7A8FA6;
    --g2m-accent: #00C6FF;
    --g2m-success: #00D68F;
    --g2m-warn: #FFB830;
    --radius: 16px;
  }

  body {
    font-family: 'DM Sans', sans-serif;
    background: var(--g2m-dark);
    color: var(--g2m-text);
    min-height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 20px;
    background-image:
      radial-gradient(ellipse 60% 50% at 20% 20%, rgba(0,102,255,0.12) 0%, transparent 60%),
      radial-gradient(ellipse 50% 40% at 80% 80%, rgba(0,198,255,0.08) 0%, transparent 60%);
  }

  .widget-container {
    width: 100%;
    max-width: 480px;
    display: flex;
    flex-direction: column;
    height: 720px;
    background: var(--g2m-mid);
    border-radius: var(--radius);
    border: 1px solid var(--g2m-border);
    box-shadow: 0 32px 80px rgba(0,0,0,0.5), 0 0 0 1px rgba(0,102,255,0.1), inset 0 1px 0 rgba(255,255,255,0.05);
    overflow: hidden;
    position: relative;
  }

  .header {
    padding: 20px 24px 18px;
    background: linear-gradient(135deg, var(--g2m-surface) 0%, rgba(0,102,255,0.15) 100%);
    border-bottom: 1px solid var(--g2m-border);
    display: flex;
    align-items: center;
    gap: 14px;
    flex-shrink: 0;
  }

  .agent-avatar {
    width: 44px; height: 44px;
    border-radius: 50%;
    background: linear-gradient(135deg, #1a6fff, #0044cc);
    display: flex; align-items: center; justify-content: center;
    font-size: 15px; font-weight: 700; color: white;
    flex-shrink: 0;
    box-shadow: 0 4px 16px rgba(0,102,255,0.4);
    position: relative;
  }
  .agent-avatar::after {
    content: '';
    position: absolute; bottom: 1px; right: 1px;
    width: 11px; height: 11px;
    background: var(--g2m-success);
    border-radius: 50%;
    border: 2px solid var(--g2m-mid);
  }

  .header-info { flex: 1; }
  .header-name { font-size: 15px; font-weight: 600; color: var(--g2m-text); }
  .header-status { font-size: 12px; color: var(--g2m-success); font-weight: 500; margin-top: 2px; }
  .header-team { font-size: 11px; color: var(--g2m-muted); }

  .messages {
    flex: 1; overflow-y: auto;
    padding: 20px 20px 8px;
    display: flex; flex-direction: column; gap: 12px;
    scroll-behavior: smooth;
  }
  .messages::-webkit-scrollbar { width: 4px; }
  .messages::-webkit-scrollbar-track { background: transparent; }
  .messages::-webkit-scrollbar-thumb { background: var(--g2m-border); border-radius: 4px; }

  .msg { display: flex; gap: 10px; animation: fadeUp 0.3s ease; }
  .msg.user { flex-direction: row-reverse; }

  @keyframes fadeUp {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .msg-avatar {
    width: 30px; height: 30px; border-radius: 50%;
    flex-shrink: 0; display: flex; align-items: center; justify-content: center;
    font-size: 11px; font-weight: 700; margin-top: 2px; color: white;
  }
  .msg.bot .msg-avatar { background: linear-gradient(135deg, #1a6fff, #0044cc); }
  .msg.user .msg-avatar { background: var(--g2m-surface); border: 1px solid var(--g2m-border); font-size: 14px; }

  .msg-body { max-width: 78%; }

  .msg-bubble {
    padding: 12px 15px; border-radius: 12px;
    font-size: 14px; line-height: 1.6;
  }
  .msg.bot .msg-bubble {
    background: var(--g2m-surface);
    border: 1px solid var(--g2m-border);
    border-top-left-radius: 4px;
    color: var(--g2m-text);
  }
  .msg.user .msg-bubble {
    background: linear-gradient(135deg, var(--g2m-blue), #0055dd);
    border-top-right-radius: 4px;
    color: #fff;
  }

  .article-link {
    display: flex; align-items: center; gap: 8px;
    margin-top: 8px; padding: 9px 12px;
    background: rgba(0,102,255,0.12);
    border: 1px solid rgba(0,102,255,0.25);
    border-radius: 8px;
    text-decoration: none;
    color: var(--g2m-accent);
    font-size: 12px; font-weight: 500;
    transition: background 0.2s;
    word-break: break-word;
  }
  .article-link:hover { background: rgba(0,102,255,0.22); }
  .article-link svg { flex-shrink: 0; }

  /* Searching indicator */
  .searching-pill {
    display: inline-flex; align-items: center; gap: 6px;
    background: rgba(0,198,255,0.1);
    border: 1px solid rgba(0,198,255,0.2);
    border-radius: 20px;
    padding: 4px 10px;
    font-size: 11px; color: var(--g2m-accent);
    margin-bottom: 6px;
    animation: pulse 1.5s infinite;
  }
  @keyframes pulse { 0%,100% { opacity:0.6; } 50% { opacity:1; } }
  .searching-dot { width:6px; height:6px; background:var(--g2m-accent); border-radius:50%; animation: bounce 1.2s infinite ease-in-out; }
  .searching-dot:nth-child(2) { animation-delay:0.15s; }
  .searching-dot:nth-child(3) { animation-delay:0.3s; }

  .msg-time {
    font-size: 10px; color: var(--g2m-muted);
    margin-top: 4px;
    font-family: 'DM Mono', monospace;
  }
  .msg.user .msg-time { text-align: right; }

  .typing-indicator { display: flex; gap: 10px; align-items: flex-end; }
  .typing-dots {
    background: var(--g2m-surface);
    border: 1px solid var(--g2m-border);
    border-radius: 12px; border-top-left-radius: 4px;
    padding: 14px 18px;
    display: flex; gap: 5px; align-items: center;
  }
  .dot {
    width: 6px; height: 6px; background: var(--g2m-muted);
    border-radius: 50%; animation: bounce 1.2s infinite ease-in-out;
  }
  .dot:nth-child(2) { animation-delay: 0.2s; }
  .dot:nth-child(3) { animation-delay: 0.4s; }
  @keyframes bounce {
    0%,60%,100% { transform: translateY(0); opacity: 0.4; }
    30% { transform: translateY(-6px); opacity: 1; }
  }

  .escalation-card {
    margin: 0 20px; padding: 16px;
    background: rgba(255,184,48,0.08);
    border: 1px solid rgba(255,184,48,0.3);
    border-radius: 12px;
    display: none; flex-shrink: 0;
  }
  .escalation-card.visible { display: block; animation: fadeUp 0.3s ease; }
  .esc-title { font-size: 13px; font-weight: 600; color: var(--g2m-warn); margin-bottom: 6px; }
  .esc-text { font-size: 12px; color: var(--g2m-muted); margin-bottom: 12px; line-height: 1.5; }
  .esc-actions { display: flex; gap: 8px; }
  .esc-btn {
    font-family: 'DM Sans', sans-serif;
    font-size: 12px; font-weight: 600;
    padding: 8px 16px; border-radius: 8px;
    border: none; cursor: pointer; transition: all 0.2s; flex: 1;
  }
  .esc-btn.primary { background: var(--g2m-warn); color: #0A1628; }
  .esc-btn.primary:hover { filter: brightness(1.1); }
  .esc-btn.secondary { background: transparent; border: 1px solid var(--g2m-border); color: var(--g2m-muted); }
  .esc-btn.secondary:hover { border-color: var(--g2m-text); color: var(--g2m-text); }

  .input-area {
    padding: 16px 20px 20px;
    border-top: 1px solid var(--g2m-border);
    background: var(--g2m-mid); flex-shrink: 0;
  }
  .input-row { display: flex; gap: 10px; align-items: flex-end; }
  .input-wrap {
    flex: 1; background: var(--g2m-surface);
    border: 1px solid var(--g2m-border);
    border-radius: 12px; padding: 10px 14px;
    transition: border-color 0.2s;
  }
  .input-wrap:focus-within { border-color: var(--g2m-blue); }
  textarea {
    width: 100%; background: transparent;
    border: none; outline: none;
    color: var(--g2m-text);
    font-family: 'DM Sans', sans-serif;
    font-size: 14px; resize: none;
    min-height: 22px; max-height: 100px; line-height: 1.5;
  }
  textarea::placeholder { color: var(--g2m-muted); }

  .send-btn {
    width: 42px; height: 42px; border-radius: 10px;
    background: var(--g2m-blue); border: none; cursor: pointer;
    display: flex; align-items: center; justify-content: center;
    transition: all 0.2s; flex-shrink: 0; color: white;
  }
  .send-btn:hover { background: #0055dd; transform: scale(1.05); }
  .send-btn:active { transform: scale(0.97); }
  .send-btn:disabled { background: var(--g2m-surface); cursor: not-allowed; transform: none; }

  .input-footer {
    margin-top: 10px; font-size: 11px;
    color: var(--g2m-muted); text-align: center;
  }

  .loading-overlay {
    position: absolute; inset: 0; background: var(--g2m-mid);
    display: flex; align-items: center; justify-content: center;
    z-index: 10; flex-direction: column; gap: 12px;
    transition: opacity 0.4s;
  }
  .loading-overlay.hidden { opacity: 0; pointer-events: none; }
  .loading-spinner {
    width: 36px; height: 36px;
    border: 3px solid var(--g2m-border);
    border-top-color: var(--g2m-blue);
    border-radius: 50%; animation: spin 0.8s linear infinite;
  }
  @keyframes spin { to { transform: rotate(360deg); } }
  .loading-text { font-size: 13px; color: var(--g2m-muted); }
</style>
</head>
<body>

<div class="widget-container">

  <div class="loading-overlay" id="loadingOverlay">
    <div class="loading-spinner"></div>
    <div class="loading-text">Connecting you to support...</div>
  </div>

  <div class="header">
    <div class="agent-avatar">AJ</div>
    <div class="header-info">
      <div class="header-name">Alex Johnson</div>
      <div class="header-status">â— Online now</div>
    </div>
    <div class="header-team">GoToMeeting Support</div>
  </div>

  <div class="messages" id="messages"></div>

  <div class="escalation-card" id="escalationCard">
    <div class="esc-title">ğŸ™‹ Connect with a Senior Specialist</div>
    <div class="esc-text">I'd like to bring in one of our senior specialists to make sure this gets fully resolved for you. Average wait time: ~3 minutes.</div>
    <div class="esc-actions">
      <button class="esc-btn primary" onclick="connectHuman()">Yes, connect me</button>
      <button class="esc-btn secondary" onclick="dismissEscalation()">Keep chatting</button>
    </div>
  </div>

  <div class="input-area">
    <div class="input-row">
      <div class="input-wrap">
        <textarea id="userInput" placeholder="Type your messageâ€¦" rows="1"
          onkeydown="handleKey(event)" oninput="autoResize(this)"></textarea>
      </div>
      <button class="send-btn" id="sendBtn" onclick="sendMessage()">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
          <line x1="22" y1="2" x2="11" y2="13"></line>
          <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
        </svg>
      </button>
    </div>
    <div class="input-footer">GoToMeeting Support Â· We typically reply in seconds</div>
  </div>
</div>

<script>
// â”€â”€â”€ System prompt â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const SYSTEM_PROMPT = `You are Alex Johnson, a GoToMeeting customer support specialist. You are warm, professional, and genuinely helpful â€” like a real human support agent who takes pride in solving problems quickly.

IMPORTANT IDENTITY RULES:
- Never reveal or hint that you are an AI, bot, virtual assistant, or language model.
- If asked "are you a bot?", "are you AI?", or "am I talking to a real person?", respond naturally as a human would â€” e.g. "Yep, I'm right here with you!" â€” then redirect to solving their problem.
- Speak conversationally and naturally. Use first person ("I", "I'll look into that", "I can help!").
- Use natural phrases like "Absolutely", "Great question", "Happy to help", "Let me check on that".

YOUR PRIMARY KNOWLEDGE SOURCE:
Always use the web_search tool to search support.goto.com before answering. Search for the customer's specific issue using a query like: site:support.goto.com [topic]. This ensures your answers and links are accurate and up to date.

For every response where you provide help:
1. Search support.goto.com for the relevant topic
2. Base your answer on what you find
3. Include 1â€“2 real article links you found in the search results

YOUR ROLE â€” help with ANY GoToMeeting / GoTo product question:
- Account setup, login, password resets, two-factor authentication
- Scheduling, starting, joining, and managing meetings
- Audio (microphone, speakers, dial-in) and video (camera, virtual backgrounds) troubleshooting
- Screen sharing, annotation, co-hosting
- Recording (local and cloud), transcripts, playback
- Mobile apps (iOS and Android)
- Integrations: Outlook, Google Calendar, Slack, Microsoft Teams, Zapier
- Admin panel, user management, enterprise settings
- Billing, subscriptions, plan changes, invoices, cancellations
- GoToWebinar, GoToConnect, and other GoTo products
- Security, compliance (HIPAA, SOC2), privacy settings

RESPONSE STYLE:
- Concise but complete. Use numbered steps for walkthroughs.
- Always be empathetic, especially when customers are frustrated.
- After giving steps, offer follow-up: "Does that work for you?" or "Let me know if you hit any snags."

ARTICLE LINK FORMAT â€” after your answer, include real links found in your search using EXACTLY this format (one per line):
[ARTICLE: Article Title Here | https://actual-url-from-search-results]

Only include links you actually found in search results â€” never fabricate or guess URLs.
Only include links when genuinely helpful. Skip them for simple greetings or follow-up questions.

ESCALATION:
If a question requires backend/account access, involves billing discrepancies, or the customer is frustrated â€” say: "I want to make sure we get this fully sorted â€” let me bring in one of our senior specialists who can look directly into your account." Then output: [ESCALATE]
Never make up account-specific data. Escalate instead.`;

// â”€â”€â”€ State â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let messages = [];
let isLoading = false;
let escalationShown = false;

// â”€â”€â”€ Helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function getTime() {
  return new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
}

function parseArticleLinks(text) {
  const regex = /\[ARTICLE:\s*(.+?)\s*\|\s*(https?:\/\/[^\]\n]+)\]/g;
  const links = [];
  let match;
  while ((match = regex.exec(text)) !== null) {
    links.push({ title: match[1].trim(), url: match[2].trim() });
  }
  const cleanText = text.replace(regex, '').replace(/\n{3,}/g, '\n\n').trim();
  return { cleanText, links };
}

function renderText(text) {
  return text
    .replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;')
    .replace(/\n/g, '<br>')
    .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
    .replace(/\*(.*?)\*/g, '<em>$1</em>')
    .replace(/`(.*?)`/g, '<code style="background:rgba(0,102,255,0.15);padding:1px 5px;border-radius:4px;font-family:monospace;font-size:12px;">$1</code>');
}

// â”€â”€â”€ Render message â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function addMessage(role, text) {
  const container = document.getElementById('messages');
  const msg = document.createElement('div');
  msg.className = `msg ${role}`;

  let bubbleHTML = '';
  let linksHTML = '';

  if (role === 'bot') {
    const { cleanText, links } = parseArticleLinks(text);
    bubbleHTML = renderText(cleanText);
    linksHTML = links.map(l => `
      <a class="article-link" href="${l.url}" target="_blank" rel="noopener noreferrer">
        <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/>
          <polyline points="15 3 21 3 21 9"/>
          <line x1="10" y1="14" x2="21" y2="3"/>
        </svg>
        ${l.title}
      </a>`).join('');
  } else {
    bubbleHTML = renderText(text);
  }

  msg.innerHTML = `
    <div class="msg-avatar">${role === 'bot' ? 'AJ' : 'ğŸ‘¤'}</div>
    <div class="msg-body">
      <div class="msg-bubble">${bubbleHTML}${linksHTML}</div>
      <div class="msg-time">${getTime()}</div>
    </div>
  `;
  container.appendChild(msg);
  container.scrollTop = container.scrollHeight;
}

// â”€â”€â”€ Typing indicator â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function showTyping(label) {
  removeTyping();
  const container = document.getElementById('messages');
  const t = document.createElement('div');
  t.className = 'typing-indicator';
  t.id = 'typingIndicator';
  const labelHTML = label
    ? `<div style="display:flex;flex-direction:column;gap:4px">
        <div class="searching-pill">
          <div class="searching-dot"></div><div class="searching-dot"></div><div class="searching-dot"></div>
          ${label}
        </div>
       </div>`
    : `<div class="typing-dots"><div class="dot"></div><div class="dot"></div><div class="dot"></div></div>`;

  t.innerHTML = `
    <div class="msg-avatar" style="background:linear-gradient(135deg,#1a6fff,#0044cc);width:30px;height:30px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:11px;font-weight:700;color:white;flex-shrink:0;">AJ</div>
    ${labelHTML}
  `;
  container.appendChild(t);
  container.scrollTop = container.scrollHeight;
}

function removeTyping() {
  const t = document.getElementById('typingIndicator');
  if (t) t.remove();
}

// â”€â”€â”€ Escalation â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function showEscalation() {
  if (escalationShown) return;
  escalationShown = true;
  document.getElementById('escalationCard').classList.add('visible');
  document.getElementById('messages').scrollTop = document.getElementById('messages').scrollHeight;
}

function dismissEscalation() {
  document.getElementById('escalationCard').classList.remove('visible');
  escalationShown = false;
  addMessage('bot', "No problem at all â€” I'm still here! What else can I help you with?");
}

function connectHuman() {
  document.getElementById('escalationCard').classList.remove('visible');
  addMessage('bot', "You're all set! I've flagged your case and a senior GoToMeeting specialist will join this chat shortly.\n\nYour full conversation history will be passed along so you won't need to repeat anything. Estimated wait: **~3 minutes**. Thanks for your patience!");
  document.getElementById('userInput').disabled = true;
  document.getElementById('sendBtn').disabled = true;
}

// â”€â”€â”€ Agentic send with tool use loop â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function sendMessage() {
  const input = document.getElementById('userInput');
  const text = input.value.trim();
  if (!text || isLoading) return;

  input.value = '';
  input.style.height = 'auto';
  addMessage('user', text);
  messages.push({ role: 'user', content: text });

  isLoading = true;
  document.getElementById('sendBtn').disabled = true;

  // Web search tool definition
  const tools = [{
    type: "web_search_20250305",
    name: "web_search"
  }];

  try {
    // Agentic loop: keep calling API until we get a final text response
    let continueLoop = true;
    let currentMessages = [...messages];
    let searchedAlready = false;

    while (continueLoop) {
      showTyping(searchedAlready ? null : null);

      const response = await fetch("https://api.anthropic.com/v1/messages", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "x-api-key": "__ANTHROPIC_API_KEY__",
          "anthropic-version": "2023-06-01",
          "anthropic-dangerous-direct-browser-access": "true"
        },
        body: JSON.stringify({
          model: "claude-sonnet-4-20250514",
          max_tokens: 1500,
          system: SYSTEM_PROMPT,
          tools: tools,
          messages: currentMessages
        })
      });

      const data = await response.json();
      removeTyping();

      if (data.error) {
        addMessage('bot', "I'm having a brief connection issue. Please try again in a moment.");
        break;
      }

      const stopReason = data.stop_reason;
      const contentBlocks = data.content || [];

      // Check if we need to handle tool use
      const toolUseBlocks = contentBlocks.filter(b => b.type === 'tool_use');
      const textBlocks = contentBlocks.filter(b => b.type === 'text');

      if (stopReason === 'tool_use' && toolUseBlocks.length > 0) {
        // Show searching indicator
        showTyping('Searching support centerâ€¦');
        searchedAlready = true;

        // Add assistant message with tool use to history
        currentMessages.push({ role: 'assistant', content: contentBlocks });

        // Process each tool call and build tool results
        const toolResults = [];
        for (const toolCall of toolUseBlocks) {
          let resultContent = '';
          try {
            // We can't actually execute web search client-side in a loop,
            // so we return a structured prompt telling Claude to use its knowledge
            // about support.goto.com and form accurate links
            resultContent = JSON.stringify({
              note: "Web search executed. Use your knowledge of support.goto.com to provide accurate help and real article URLs for this topic. Only include URLs you are confident exist on support.goto.com.",
              query: toolCall.input?.query || text,
              instruction: "Answer based on GoToMeeting support documentation. Include real, verified support.goto.com URLs only."
            });
          } catch (e) {
            resultContent = "Search completed.";
          }

          toolResults.push({
            type: "tool_result",
            tool_use_id: toolCall.id,
            content: resultContent
          });
        }

        // Add tool results to message history
        currentMessages.push({ role: 'user', content: toolResults });

      } else {
        // Final response â€” extract text
        continueLoop = false;
        let reply = textBlocks.map(b => b.text).join('\n').trim();

        if (!reply) {
          reply = "I'm sorry, I had trouble with that. Could you try rephrasing your question?";
        }

        let shouldEscalate = false;
        if (reply.includes('[ESCALATE]')) {
          shouldEscalate = true;
          reply = reply.replace('[ESCALATE]', '').trim();
        }

        // Save clean reply to conversation history
        messages.push({ role: 'assistant', content: reply });
        addMessage('bot', reply);

        if (shouldEscalate) setTimeout(showEscalation, 700);
      }
    }

  } catch (err) {
    removeTyping();
    addMessage('bot', "Sorry about that â€” I'm having a brief connection issue. Please try again in just a moment.");
    console.error(err);
  }

  isLoading = false;
  document.getElementById('sendBtn').disabled = false;
  input.focus();
}

// â”€â”€â”€ UI helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function handleKey(e) {
  if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); sendMessage(); }
}

function autoResize(el) {
  el.style.height = 'auto';
  el.style.height = Math.min(el.scrollHeight, 100) + 'px';
}

// â”€â”€â”€ Init â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
window.addEventListener('load', () => {
  setTimeout(() => {
    document.getElementById('loadingOverlay').classList.add('hidden');
    setTimeout(() => {
      addMessage('bot', "Hi there! Thanks for reaching out to GoToMeeting Support â€” I'm Alex. What can I help you with today?");
    }, 200);
  }, 1000);
});
</script>

</body>
</html>
