<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GoToMeeting Support Agent</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=DM+Sans:wght@300;400;500;600&family=DM+Mono:wght@400;500&display=swap');

  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  :root {
    --g2m-blue: #0066FF;
    --g2m-dark: #0A1628;
    --g2m-mid: #132040;
    --g2m-surface: #1A2D50;
    --g2m-border: rgba(0,102,255,0.2);
    --g2m-text: #E8EDF5;
    --g2m-muted: #7A8FA6;
    --g2m-accent: #00C6FF;
    --g2m-success: #00D68F;
    --g2m-warn: #FFB830;
    --radius: 16px;
  }

  body {
    font-family: 'DM Sans', sans-serif;
    background: var(--g2m-dark);
    color: var(--g2m-text);
    min-height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 20px;
    background-image: 
      radial-gradient(ellipse 60% 50% at 20% 20%, rgba(0,102,255,0.12) 0%, transparent 60%),
      radial-gradient(ellipse 50% 40% at 80% 80%, rgba(0,198,255,0.08) 0%, transparent 60%);
  }

  .widget-container {
    width: 100%;
    max-width: 480px;
    display: flex;
    flex-direction: column;
    height: 720px;
    background: var(--g2m-mid);
    border-radius: var(--radius);
    border: 1px solid var(--g2m-border);
    box-shadow: 0 32px 80px rgba(0,0,0,0.5), 0 0 0 1px rgba(0,102,255,0.1), inset 0 1px 0 rgba(255,255,255,0.05);
    overflow: hidden;
    position: relative;
  }

  /* Header */
  .header {
    padding: 20px 24px 18px;
    background: linear-gradient(135deg, var(--g2m-surface) 0%, rgba(0,102,255,0.15) 100%);
    border-bottom: 1px solid var(--g2m-border);
    display: flex;
    align-items: center;
    gap: 14px;
    flex-shrink: 0;
  }

  .agent-avatar {
    width: 44px;
    height: 44px;
    border-radius: 12px;
    background: linear-gradient(135deg, var(--g2m-blue), var(--g2m-accent));
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 20px;
    flex-shrink: 0;
    box-shadow: 0 4px 16px rgba(0,102,255,0.4);
    position: relative;
  }

  .agent-avatar::after {
    content: '';
    position: absolute;
    bottom: -2px;
    right: -2px;
    width: 12px;
    height: 12px;
    background: var(--g2m-success);
    border-radius: 50%;
    border: 2px solid var(--g2m-mid);
  }

  .header-info { flex: 1; }
  .header-name { font-size: 15px; font-weight: 600; color: var(--g2m-text); }
  .header-status { font-size: 12px; color: var(--g2m-success); font-weight: 500; margin-top: 2px; }

  .header-badge {
    font-family: 'DM Mono', monospace;
    font-size: 10px;
    background: rgba(0,102,255,0.2);
    color: var(--g2m-accent);
    border: 1px solid rgba(0,198,255,0.25);
    padding: 4px 10px;
    border-radius: 20px;
    letter-spacing: 0.05em;
  }

  /* Messages */
  .messages {
    flex: 1;
    overflow-y: auto;
    padding: 20px 20px 8px;
    display: flex;
    flex-direction: column;
    gap: 12px;
    scroll-behavior: smooth;
  }

  .messages::-webkit-scrollbar { width: 4px; }
  .messages::-webkit-scrollbar-track { background: transparent; }
  .messages::-webkit-scrollbar-thumb { background: var(--g2m-border); border-radius: 4px; }

  .msg { display: flex; gap: 10px; animation: fadeUp 0.3s ease; max-width: 100%; }
  .msg.user { flex-direction: row-reverse; }

  @keyframes fadeUp {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .msg-avatar {
    width: 30px;
    height: 30px;
    border-radius: 8px;
    flex-shrink: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 14px;
    margin-top: 2px;
  }
  .msg.bot .msg-avatar { background: linear-gradient(135deg, var(--g2m-blue), var(--g2m-accent)); }
  .msg.user .msg-avatar { background: var(--g2m-surface); border: 1px solid var(--g2m-border); }

  .msg-bubble {
    max-width: 78%;
    padding: 12px 15px;
    border-radius: 12px;
    font-size: 14px;
    line-height: 1.55;
  }
  .msg.bot .msg-bubble {
    background: var(--g2m-surface);
    border: 1px solid var(--g2m-border);
    border-top-left-radius: 4px;
    color: var(--g2m-text);
  }
  .msg.user .msg-bubble {
    background: linear-gradient(135deg, var(--g2m-blue), #0055dd);
    border-top-right-radius: 4px;
    color: #fff;
  }

  .msg-time {
    font-size: 10px;
    color: var(--g2m-muted);
    margin-top: 4px;
    font-family: 'DM Mono', monospace;
  }
  .msg.user .msg-time { text-align: right; }

  /* Typing indicator */
  .typing-indicator { display: flex; gap: 10px; align-items: flex-end; }
  .typing-dots {
    background: var(--g2m-surface);
    border: 1px solid var(--g2m-border);
    border-radius: 12px;
    border-top-left-radius: 4px;
    padding: 14px 18px;
    display: flex;
    gap: 5px;
    align-items: center;
  }
  .dot {
    width: 6px; height: 6px;
    background: var(--g2m-muted);
    border-radius: 50%;
    animation: bounce 1.2s infinite ease-in-out;
  }
  .dot:nth-child(2) { animation-delay: 0.2s; }
  .dot:nth-child(3) { animation-delay: 0.4s; }
  @keyframes bounce {
    0%, 60%, 100% { transform: translateY(0); opacity: 0.4; }
    30% { transform: translateY(-6px); opacity: 1; }
  }

  /* Quick replies */
  .quick-replies {
    padding: 8px 20px 4px;
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    flex-shrink: 0;
  }
  .quick-btn {
    font-family: 'DM Sans', sans-serif;
    font-size: 12px;
    font-weight: 500;
    padding: 7px 14px;
    border-radius: 20px;
    border: 1px solid var(--g2m-border);
    background: rgba(0,102,255,0.08);
    color: var(--g2m-accent);
    cursor: pointer;
    transition: all 0.2s;
    white-space: nowrap;
  }
  .quick-btn:hover { background: rgba(0,102,255,0.2); border-color: var(--g2m-accent); transform: translateY(-1px); }

  /* Escalation card */
  .escalation-card {
    margin: 0 20px;
    padding: 16px;
    background: rgba(255,184,48,0.08);
    border: 1px solid rgba(255,184,48,0.3);
    border-radius: 12px;
    display: none;
    flex-shrink: 0;
  }
  .escalation-card.visible { display: block; animation: fadeUp 0.3s ease; }
  .esc-title { font-size: 13px; font-weight: 600; color: var(--g2m-warn); margin-bottom: 6px; display: flex; align-items: center; gap: 6px; }
  .esc-text { font-size: 12px; color: var(--g2m-muted); margin-bottom: 12px; line-height: 1.5; }
  .esc-actions { display: flex; gap: 8px; }
  .esc-btn {
    font-family: 'DM Sans', sans-serif;
    font-size: 12px;
    font-weight: 600;
    padding: 8px 16px;
    border-radius: 8px;
    border: none;
    cursor: pointer;
    transition: all 0.2s;
    flex: 1;
  }
  .esc-btn.primary { background: var(--g2m-warn); color: #0A1628; }
  .esc-btn.primary:hover { filter: brightness(1.1); }
  .esc-btn.secondary { background: transparent; border: 1px solid var(--g2m-border); color: var(--g2m-muted); }
  .esc-btn.secondary:hover { border-color: var(--g2m-text); color: var(--g2m-text); }

  /* Input area */
  .input-area {
    padding: 16px 20px 20px;
    border-top: 1px solid var(--g2m-border);
    background: var(--g2m-mid);
    flex-shrink: 0;
  }
  .input-row {
    display: flex;
    gap: 10px;
    align-items: flex-end;
  }
  .input-wrap {
    flex: 1;
    background: var(--g2m-surface);
    border: 1px solid var(--g2m-border);
    border-radius: 12px;
    padding: 10px 14px;
    transition: border-color 0.2s;
  }
  .input-wrap:focus-within { border-color: var(--g2m-blue); }
  textarea {
    width: 100%;
    background: transparent;
    border: none;
    outline: none;
    color: var(--g2m-text);
    font-family: 'DM Sans', sans-serif;
    font-size: 14px;
    resize: none;
    min-height: 22px;
    max-height: 100px;
    line-height: 1.5;
  }
  textarea::placeholder { color: var(--g2m-muted); }

  .send-btn {
    width: 42px;
    height: 42px;
    border-radius: 10px;
    background: var(--g2m-blue);
    border: none;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s;
    flex-shrink: 0;
    color: white;
  }
  .send-btn:hover { background: #0055dd; transform: scale(1.05); }
  .send-btn:active { transform: scale(0.97); }
  .send-btn:disabled { background: var(--g2m-surface); cursor: not-allowed; transform: none; }

  .input-footer {
    margin-top: 10px;
    font-size: 11px;
    color: var(--g2m-muted);
    text-align: center;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 4px;
  }

  /* Skeleton for loading */
  .loading-overlay {
    position: absolute;
    inset: 0;
    background: var(--g2m-mid);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 10;
    flex-direction: column;
    gap: 12px;
    transition: opacity 0.4s;
  }
  .loading-overlay.hidden { opacity: 0; pointer-events: none; }
  .loading-spinner {
    width: 36px; height: 36px;
    border: 3px solid var(--g2m-border);
    border-top-color: var(--g2m-blue);
    border-radius: 50%;
    animation: spin 0.8s linear infinite;
  }
  @keyframes spin { to { transform: rotate(360deg); } }
  .loading-text { font-size: 13px; color: var(--g2m-muted); }
</style>
</head>
<body>

<div class="widget-container">

  <!-- Loading overlay -->
  <div class="loading-overlay" id="loadingOverlay">
    <div class="loading-spinner"></div>
    <div class="loading-text">Connecting to support...</div>
  </div>

  <!-- Header -->
  <div class="header">
    <div class="agent-avatar">ü§ù</div>
    <div class="header-info">
      <div class="header-name">GoToMeeting Support</div>
      <div class="header-status">‚óè Online ‚Äî ready to help</div>
    </div>
    <div class="header-badge">AI AGENT</div>
  </div>

  <!-- Messages -->
  <div class="messages" id="messages"></div>

  <!-- Quick replies -->
  <div class="quick-replies" id="quickReplies"></div>

  <!-- Escalation card -->
  <div class="escalation-card" id="escalationCard">
    <div class="esc-title">üôã Connect with a Human Agent</div>
    <div class="esc-text">Our Level 2 support team is ready to assist you further. Average wait time: ~3 minutes.</div>
    <div class="esc-actions">
      <button class="esc-btn primary" onclick="connectHuman()">Connect Now</button>
      <button class="esc-btn secondary" onclick="dismissEscalation()">Keep Chatting</button>
    </div>
  </div>

  <!-- Input -->
  <div class="input-area">
    <div class="input-row">
      <div class="input-wrap">
        <textarea id="userInput" placeholder="Ask anything about GoToMeeting‚Ä¶" rows="1" onkeydown="handleKey(event)" oninput="autoResize(this)"></textarea>
      </div>
      <button class="send-btn" id="sendBtn" onclick="sendMessage()">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
          <line x1="22" y1="2" x2="11" y2="13"></line>
          <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
        </svg>
      </button>
    </div>
    <div class="input-footer">
      <svg width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="11" width="18" height="11" rx="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>
      Powered by Anthropic Claude ¬∑ GoToMeeting Support
    </div>
  </div>
</div>

<script>
const SYSTEM_PROMPT = `You are a friendly and highly knowledgeable GoToMeeting customer support AI agent. Your name is "GoTo Assist."

Your role is to help customers with ANY questions or issues related to GoToMeeting and GoTo products, including:
- Account setup, login, and billing
- Scheduling, starting, and joining meetings
- Audio and video troubleshooting
- Screen sharing and recording
- Mobile app issues
- Integrations (Outlook, Google Calendar, Slack, etc.)
- Admin panel and enterprise settings
- Webinar features (GoToWebinar)
- GoToConnect and phone features
- Security settings and compliance
- Cancellations and plan changes

Tone: Professional but warm. Be concise ‚Äî keep responses to 2‚Äì4 short paragraphs or use brief bullet points when listing steps. Use simple, non-technical language unless the customer seems technical.

Important behaviors:
1. If you know the answer, provide clear step-by-step help.
2. If you're not certain or the issue is complex/account-specific, say something like: "This might need a closer look from our Level 2 team. Would you like me to connect you with a specialist?" ‚Äî then output the exact token: [ESCALATE]
3. If a user seems frustrated or asks to speak to a human, offer to escalate and output: [ESCALATE]
4. Never make up specific account details, billing amounts, or policy specifics you aren't sure about.
5. Always be solution-oriented and empathetic.

Current date context: You are live on the GoToMeeting support page helping a customer in real time.`;

let messages = [];
let isLoading = false;
let escalationShown = false;
let turnCount = 0;

const QUICK_REPLIES_INITIAL = [
  "Can't join a meeting", "Audio not working", "How do I schedule?",
  "Billing question", "Reset my password", "Recording help"
];

function getTime() {
  return new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
}

function addMessage(role, text, showTime = true) {
  const container = document.getElementById('messages');
  const msg = document.createElement('div');
  msg.className = `msg ${role}`;

  const avatar = role === 'bot' ? 'ü§ù' : 'üë§';
  const time = getTime();

  msg.innerHTML = `
    <div class="msg-avatar">${avatar}</div>
    <div>
      <div class="msg-bubble">${text.replace(/\n/g, '<br>').replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>').replace(/\*(.*?)\*/g, '<em>$1</em>')}</div>
      ${showTime ? `<div class="msg-time">${time}</div>` : ''}
    </div>
  `;
  container.appendChild(msg);
  container.scrollTop = container.scrollHeight;
}

function showTyping() {
  const container = document.getElementById('messages');
  const t = document.createElement('div');
  t.className = 'typing-indicator';
  t.id = 'typingIndicator';
  t.innerHTML = `
    <div class="msg-avatar" style="background: linear-gradient(135deg, var(--g2m-blue), var(--g2m-accent)); width:30px; height:30px; border-radius:8px; display:flex; align-items:center; justify-content:center; font-size:14px; flex-shrink:0;">ü§ù</div>
    <div class="typing-dots"><div class="dot"></div><div class="dot"></div><div class="dot"></div></div>
  `;
  container.appendChild(t);
  container.scrollTop = container.scrollHeight;
}

function removeTyping() {
  const t = document.getElementById('typingIndicator');
  if (t) t.remove();
}

function setQuickReplies(options) {
  const qr = document.getElementById('quickReplies');
  qr.innerHTML = '';
  options.forEach(opt => {
    const btn = document.createElement('button');
    btn.className = 'quick-btn';
    btn.textContent = opt;
    btn.onclick = () => { document.getElementById('userInput').value = opt; sendMessage(); };
    qr.appendChild(btn);
  });
}

function clearQuickReplies() {
  document.getElementById('quickReplies').innerHTML = '';
}

function showEscalation() {
  if (escalationShown) return;
  escalationShown = true;
  document.getElementById('escalationCard').classList.add('visible');
  document.getElementById('messages').scrollTop = document.getElementById('messages').scrollHeight;
}

function dismissEscalation() {
  document.getElementById('escalationCard').classList.remove('visible');
  escalationShown = false;
  addMessage('bot', "No problem! I'm still here. What else can I help you with?");
}

function connectHuman() {
  document.getElementById('escalationCard').classList.remove('visible');
  addMessage('bot', "‚úÖ **You're being connected to a Level 2 agent now.**\n\nPlease stay in this chat ‚Äî a specialist will join shortly. Your conversation history has been shared with them so you won't need to repeat yourself.\n\nEstimated wait time: **~3 minutes**.");
  document.getElementById('userInput').disabled = true;
  document.getElementById('sendBtn').disabled = true;
  document.getElementById('quickReplies').innerHTML = '';
}

async function sendMessage() {
  const input = document.getElementById('userInput');
  const text = input.value.trim();
  if (!text || isLoading) return;

  clearQuickReplies();
  input.value = '';
  input.style.height = 'auto';
  addMessage('user', text);

  messages.push({ role: 'user', content: text });
  turnCount++;
  isLoading = true;
  document.getElementById('sendBtn').disabled = true;

  showTyping();

  try {
    const response = await fetch("https://api.anthropic.com/v1/messages", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        model: "claude-sonnet-4-20250514",
        max_tokens: 1000,
        system: SYSTEM_PROMPT,
        messages: messages
      })
    });

    const data = await response.json();
    removeTyping();

    let reply = data.content?.[0]?.text || "I'm sorry, I had trouble processing that. Please try again.";

    let shouldEscalate = false;
    if (reply.includes('[ESCALATE]')) {
      shouldEscalate = true;
      reply = reply.replace('[ESCALATE]', '').trim();
    }

    messages.push({ role: 'assistant', content: reply });
    addMessage('bot', reply);

    if (shouldEscalate) {
      setTimeout(showEscalation, 600);
    } else if (turnCount >= 6 && !escalationShown) {
      // Proactively offer escalation after several turns
      setTimeout(() => {
        setQuickReplies(["Yes, connect me", "No, keep helping me"]);
      }, 300);
    } else {
      // Suggest contextual quick replies
      const contextual = getContextualReplies(text, reply);
      if (contextual.length > 0) setQuickReplies(contextual);
    }

  } catch (err) {
    removeTyping();
    addMessage('bot', "Sorry, I'm having a connection issue. Please try again in a moment.");
    console.error(err);
  }

  isLoading = false;
  document.getElementById('sendBtn').disabled = false;
  input.focus();
}

function getContextualReplies(userText, botReply) {
  const t = (userText + botReply).toLowerCase();
  if (t.includes('audio') || t.includes('mic') || t.includes('sound'))
    return ["Still not working", "Try video instead", "Contact human agent"];
  if (t.includes('schedul') || t.includes('meeting'))
    return ["Add to calendar", "Invite participants", "Set recurrence"];
  if (t.includes('record') || t.includes('transcript'))
    return ["Where are recordings?", "Share recording", "Enable cloud recording"];
  if (t.includes('bill') || t.includes('subscription') || t.includes('plan'))
    return ["Upgrade my plan", "Cancel subscription", "See billing history"];
  if (t.includes('password') || t.includes('login') || t.includes('access'))
    return ["Reset via email", "Two-factor auth help", "Account locked"];
  return [];
}

function handleKey(e) {
  if (e.key === 'Enter' && !e.shiftKey) {
    e.preventDefault();
    sendMessage();
  }
}

function autoResize(el) {
  el.style.height = 'auto';
  el.style.height = Math.min(el.scrollHeight, 100) + 'px';
}

// Init
window.addEventListener('load', () => {
  setTimeout(() => {
    document.getElementById('loadingOverlay').classList.add('hidden');
    setTimeout(() => {
      addMessage('bot', "üëã Hi there! I'm **GoTo Assist**, your AI support agent for GoToMeeting.\n\nI can help you with meetings, audio/video, billing, account settings, integrations, and more. What can I help you with today?");
      setQuickReplies(QUICK_REPLIES_INITIAL);
    }, 200);
  }, 1200);
});
</script>

</body>
</html>
